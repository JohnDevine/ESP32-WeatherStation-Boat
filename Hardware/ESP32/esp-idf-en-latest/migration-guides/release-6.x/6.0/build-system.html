<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-73KGWFC8DM"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'G-73KGWFC8DM');
        </script><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Build System - ESP32 -  &mdash; ESP-IDF Programming Guide latest documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=a60756f2" />
      <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=949a1ff5" />
      <link rel="stylesheet" type="text/css" href="../../../_static/theme_overrides.css?v=851bd809" />
      <link rel="stylesheet" type="text/css" href="../../../_static/js/chatbot_widget.css?v=3106ea3a" />

  
    <link rel="canonical" href="https://docs.espressif.com/projects/esp-idf/en/stable/esp32/migration-guides/release-6.x/6.0/build-system.html" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js?v=becddca3"></script>
        <script src="../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../_static/sphinx_highlight.js?v=4825356b"></script>
        <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../../_static/copybutton.js?v=ff8fa330"></script>
        <script src="https://wavedrom.com/skins/default.js"></script>
        <script src="https://wavedrom.com/wavedrom.min.js"></script>
        <script src="../../../_static/js/chatbot_widget_en.js?v=63d6728d"></script>
    <script src="../../../_static/js/theme.js"></script>

    
        

    <script type="text/javascript">
        DOCUMENTATION_OPTIONS.PAGENAME = 'migration-guides/release-6.x/6.0/build-system';
        DOCUMENTATION_OPTIONS.PROJECT_SLUG = 'esp-idf';
        DOCUMENTATION_OPTIONS.LATEST_BRANCH_NAME = 'master';
        DOCUMENTATION_OPTIONS.VERSIONS_URL = 'https://dl.espressif.com/dl/esp-idf/idf_versions.js';
        DOCUMENTATION_OPTIONS.LANGUAGES = ["en", "zh_CN"];
        DOCUMENTATION_OPTIONS.IDF_TARGET = 'esp32';
        DOCUMENTATION_OPTIONS.HAS_IDF_TARGETS = ["esp32", "esp32s2", "esp32s3", "esp32c3", "esp32c2", "esp32c5", "esp32c6", "esp32p4"]
        DOCUMENTATION_OPTIONS.RELEASE = 'latest';
        DOCUMENTATION_OPTIONS.LANGUAGE_URL = 'en';

    </script>

    <script type="text/javascript" src="https://dl.espressif.com/dl/esp-idf/idf_versions.js"></script>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Peripherals" href="peripherals.html" />
    <link rel="prev" title="Migration from 5.5 to 6.0" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            ESP-IDF Programming Guide
              <img src="../../../_static/espressif-logo.svg" class="logo" alt="Logo"/>
          </a>

          
            <div class="selectors">
              <select id="target-select" style="width: 150px;" hidden>
                <option value="" disabled selected>Choose target...</option>
              </select>
            </div>
          

          <div class="selectors">
            <select id="version-select" style="width: 150px;" hidden>
              <option value="" disabled selected>Choose version...</option>
            </select>
          </div>

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../get-started/index.html">Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api-reference/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../hw-reference/index.html">Hardware Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api-guides/index.html">API Guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../security/index.html">Security Guides</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">Migration Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../index.html#esp-idf-5-x-migration-guide">ESP-IDF 5.x Migration Guide</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html#esp-idf-6-x-migration-guide">ESP-IDF 6.x Migration Guide</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Migration from 5.5 to 6.0</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">Build System</a></li>
<li class="toctree-l4"><a class="reference internal" href="peripherals.html">Peripherals</a></li>
<li class="toctree-l4"><a class="reference internal" href="provisioning.html">Provisioning</a></li>
<li class="toctree-l4"><a class="reference internal" href="protocols.html">ESP-Modbus</a></li>
<li class="toctree-l4"><a class="reference internal" href="security.html">Security</a></li>
<li class="toctree-l4"><a class="reference internal" href="tools.html">Tools</a></li>
<li class="toctree-l4"><a class="reference internal" href="system.html">System</a></li>
<li class="toctree-l4"><a class="reference internal" href="toolchain.html">Toolchain</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../libraries-and-frameworks/index.html">Libraries and Frameworks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contribute/index.html">Contributions Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../versions.html">ESP-IDF Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../resources.html">Resources</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../COPYRIGHT.html">Copyrights and Licenses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../languages.html">Switch Between Languages</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ESP-IDF Programming Guide</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Migration Guides</a></li>
          <li class="breadcrumb-item"><a href="index.html">Migration from 5.5 to 6.0</a></li>
      <li class="breadcrumb-item active">Build System</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/espressif/esp-idf/blob/758939ca/docs/en/migration-guides/release-6.x/6.0/build-system.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="build-system">
<h1>Build System<a class="headerlink" href="#build-system" title="Permalink to this heading"></a></h1>
<p><a class="reference external" href="../../../../../../zh_CN/latest/esp32/migration-guides/release-6.x/6.0/build-system.html">[中文]</a></p>
<section id="linker-orphan-handling-behavior-changed-to-error">
<h2>Linker Orphan-Handling Behavior Changed to Error<a class="headerlink" href="#linker-orphan-handling-behavior-changed-to-error" title="Permalink to this heading"></a></h2>
<p>Starting with ESP-IDF v6.0, the build system no longer allows orphan sections in the final ELF file. The linker will now produce an error if any orphan sections are encountered during linking.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>An <em>orphan section</em> is a section that is not explicitly placed into any output section by the linker script and is not discarded during linking.</p>
</div>
<section id="how-to-resolve-orphan-section-errors">
<h3>How to Resolve Orphan Section Errors<a class="headerlink" href="#how-to-resolve-orphan-section-errors" title="Permalink to this heading"></a></h3>
<p>If you encounter an orphan section error during linking, you can resolve it using one of the following methods:</p>
<ol class="arabic simple">
<li><p>Remove the code or data that causes the orphan section, if it's unused or unnecessary.</p></li>
<li><p>Explicitly place the orphan section using a <a class="reference internal" href="../../../api-guides/linker-script-generation.html#ldgen-linker-fragment-files"><span class="std std-ref">linker fragment file</span></a>.</p></li>
<li><p>Suppress errors by setting <a class="reference internal" href="../../../api-reference/kconfig-reference.html#config-compiler-orphan-sections"><span class="std std-ref">CONFIG_COMPILER_ORPHAN_SECTIONS</span></a> to <code class="docutils literal notranslate"><span class="pre">warning</span></code> or <code class="docutils literal notranslate"><span class="pre">place</span></code>.</p></li>
</ol>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The option 3 is <strong>not recommended</strong>, as orphan sections may indicate misconfigured memory mapping or unintentional behavior in your application.</p>
</div>
</section>
</section>
<section id="change-in-global-constructor-order">
<h2>Change in Global Constructor Order<a class="headerlink" href="#change-in-global-constructor-order" title="Permalink to this heading"></a></h2>
<p>Initially, global constructors were executed using the internal <code class="docutils literal notranslate"><span class="pre">do_global_ctors()`</span></code> function. This approach was used to support Xtensa targets, which emit <code class="docutils literal notranslate"><span class="pre">.ctors.*</span></code> sections ordered in <strong>descending</strong> order.</p>
<p>On RISC-V targets, the toolchain emits <code class="docutils literal notranslate"><span class="pre">.init_array.*</span></code> sections, which follow a standard <strong>ascending</strong> order. While priority constructors in <code class="docutils literal notranslate"><span class="pre">.init_array.*</span></code> were correctly processed, the non-priority <code class="docutils literal notranslate"><span class="pre">.init_array</span></code> section was previously handled in <strong>descending</strong> order and matched the Xtensa <code class="docutils literal notranslate"><span class="pre">.ctors</span></code> behavior.</p>
<p>Starting from ESP-IDF v6.0, the startup code uses <code class="docutils literal notranslate"><span class="pre">__libc_init_array()</span></code>, consistent with standard toolchain behavior. This function processes both priority and non-priority constructors in <strong>ascending</strong> order.</p>
<p>To support this behavior, the following breaking changes were introduced:</p>
<ul class="simple">
<li><p>On Xtensa targets <code class="docutils literal notranslate"><span class="pre">.ctors.*</span></code> entries are now converted to ascending order to ensure compatibility with <code class="docutils literal notranslate"><span class="pre">__libc_init_array()</span></code>.</p></li>
<li><p>The processing order of non-priority <code class="docutils literal notranslate"><span class="pre">.init_array</span></code> and legacy <code class="docutils literal notranslate"><span class="pre">.ctors</span></code> sections was changed from <strong>descending</strong> to <strong>ascending</strong>.</p></li>
</ul>
<p>These changes align ESP-IDF with toolchain expectations and improve consistency across supported architectures.</p>
<p>If the application relies on the previous (descending) constructor order and is affected by this change, consider the following approaches.</p>
<section id="update-constructor-registration-logic">
<h3>Update Constructor Registration Logic<a class="headerlink" href="#update-constructor-registration-logic" title="Permalink to this heading"></a></h3>
<p>In some cases, data structures were built assuming that constructors run in reverse order. To preserve the original behavior, update the registration logic to insert new items at the tail instead of the head.</p>
<p>Example (from <code class="docutils literal notranslate"><span class="pre">components/unity/unity_runner.c</span></code>):</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="gd">-    // Insert at the head</span>
<span class="gd">-    desc-&gt;next = s_unity_tests_first;</span>
<span class="gd">-    s_unity_tests_first = desc;</span>
<span class="gi">+    // Insert at the end</span>
<span class="gi">+    _unity_tests_last-&gt;next = desc;</span>
<span class="gi">+    s_unity_tests_last = desc;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This approach is suitable only for very specific cases.</p>
</div>
</section>
<section id="use-constructor-priorities">
<h3>Use Constructor Priorities<a class="headerlink" href="#use-constructor-priorities" title="Permalink to this heading"></a></h3>
<p>To explicitly control constructor order, use the <code class="docutils literal notranslate"><span class="pre">constructor()</span></code> function attribute with a numeric priority:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="n">__attribute__</span><span class="p">((</span><span class="n">constructor</span><span class="p">(</span><span class="n">PRIO</span><span class="p">)))</span>
<span class="kt">void</span><span class="w"> </span><span class="n">foo</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
</pre></div>
</div>
<p>Replace <code class="docutils literal notranslate"><span class="pre">PRIO</span></code> with an integer value. Lower values are executed earlier. This is the preferred method when specific ordering is required.</p>
</section>
</section>
<section id="changes-in-configuration-files-syntax">
<h2>Changes in Configuration Files Syntax<a class="headerlink" href="#changes-in-configuration-files-syntax" title="Permalink to this heading"></a></h2>
<p>ESP-IDF v6 uses esp-idf-kconfig v3, which introduces several changes in the configuration (<code class="docutils literal notranslate"><span class="pre">Kconfig</span></code>) files. For the full list of changes, please refer to the <a class="reference external" href="https://docs.espressif.com/projects/esp-idf-kconfig/en/latest/developer-guide/migration-guide.html">esp-idf-kconfig migration guide from v2.x to v3.x</a>.</p>
</section>
</section>

    <script type="text/javascript">
        function init() {
            WaveDrom.ProcessAll();
        }
        window.onload = init;
    </script>

           </div>
             <div class="articleComments">

<style>
    .expand-feedback-content {
        display: none;
    }
    .click-like-or-dislike {
        background-color: #d3d3d3;
        pointer-events: none;
    }
</style>

<script>
    function submitFeedbackForm(user_likes_document) {
        // Send to GA4 the user reaction
        gtag('event', 'user_reaction', {
            'user_likes_document': user_likes_document
        });

        if (user_likes_document === 1) {
            document.querySelector('.like-btn').classList.add('click-like-or-dislike');
            document.getElementById("expandContentLike").style.display = 'block';
        } else {
            document.querySelector('.dislike-btn').classList.add('click-like-or-dislike');
            document.getElementById("expandContent").style.display = 'block';
        }

        document.querySelector('.like-btn').style.pointerEvents = 'none';
        document.querySelector('.dislike-btn').style.pointerEvents = 'none';
    }
</script>

<hr>

<p style="text-align:center"><strong>Was this page helpful?</strong></p>
<p style="text-align:center">
    <button class="like-btn" onclick="submitFeedbackForm(1)">
        <svg aria-hidden="true" focusable="false" class="color-fg-muted" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" style="display:inline-block;user-select:none;vertical-align:text-bottom;overflow:visible">
            <path d="M8.834.066c.763.087 1.5.295 2.01.884.505.581.656 1.378.656 2.3 0 .467-.087 1.119-.157 1.637L11.328 5h1.422c.603 0 1.174.085 1.668.333.508.254.911.679 1.137 1.2.453.998.438 2.447.188 4.316l-.04.306c-.105.79-.195 1.473-.313 2.033-.131.63-.315 1.209-.668 1.672C13.97 15.847 12.706 16 11 16c-1.848 0-3.234-.333-4.388-.653-.165-.045-.323-.09-.475-.133-.658-.186-1.2-.34-1.725-.415A1.75 1.75 0 0 1 2.75 16h-1A1.75 1.75 0 0 1 0 14.25v-7.5C0 5.784.784 5 1.75 5h1a1.75 1.75 0 0 1 1.514.872c.258-.105.59-.268.918-.508C5.853 4.874 6.5 4.079 6.5 2.75v-.5c0-1.202.994-2.337 2.334-2.184ZM4.5 13.3c.705.088 1.39.284 2.072.478l.441.125c1.096.305 2.334.598 3.987.598 1.794 0 2.28-.223 2.528-.549.147-.193.276-.505.394-1.07.105-.502.188-1.124.295-1.93l.04-.3c.25-1.882.189-2.933-.068-3.497a.921.921 0 0 0-.442-.48c-.208-.104-.52-.174-.997-.174H11c-.686 0-1.295-.577-1.206-1.336.023-.192.05-.39.076-.586.065-.488.13-.97.13-1.328 0-.809-.144-1.15-.288-1.316-.137-.158-.402-.304-1.048-.378C8.357 1.521 8 1.793 8 2.25v.5c0 1.922-.978 3.128-1.933 3.825a5.831 5.831 0 0 1-1.567.81ZM2.75 6.5h-1a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h1a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path>
        </svg>
    </button>
    <button class="dislike-btn" onclick="submitFeedbackForm(0)">
        <svg aria-hidden="true" focusable="false" class="" viewBox="0 0 16 16" width="16" height="16" fill="currentColor" style="display:inline-block;user-select:none;vertical-align:text-bottom;overflow:visible">
            <path d="M7.083 15.986c-.763-.087-1.499-.295-2.011-.884-.504-.581-.655-1.378-.655-2.299 0-.468.087-1.12.157-1.638l.015-.112H3.167c-.603 0-1.174-.086-1.669-.334a2.415 2.415 0 0 1-1.136-1.2c-.454-.998-.438-2.447-.188-4.316l.04-.306C.32 4.108.41 3.424.526 2.864c.132-.63.316-1.209.669-1.672C1.947.205 3.211.053 4.917.053c1.848 0 3.234.332 4.388.652l.474.133c.658.187 1.201.341 1.726.415a1.75 1.75 0 0 1 1.662-1.2h1c.966 0 1.75.784 1.75 1.75v7.5a1.75 1.75 0 0 1-1.75 1.75h-1a1.75 1.75 0 0 1-1.514-.872c-.259.105-.59.268-.919.508-.671.491-1.317 1.285-1.317 2.614v.5c0 1.201-.994 2.336-2.334 2.183Zm4.334-13.232c-.706-.089-1.39-.284-2.072-.479l-.441-.125c-1.096-.304-2.335-.597-3.987-.597-1.794 0-2.28.222-2.529.548-.147.193-.275.505-.393 1.07-.105.502-.188 1.124-.295 1.93l-.04.3c-.25 1.882-.19 2.933.067 3.497a.923.923 0 0 0 .443.48c.208.104.52.175.997.175h1.75c.685 0 1.295.577 1.205 1.335-.022.192-.049.39-.075.586-.066.488-.13.97-.13 1.329 0 .808.144 1.15.288 1.316.137.157.401.303 1.048.377.307.035.664-.237.664-.693v-.5c0-1.922.978-3.127 1.932-3.825a5.878 5.878 0 0 1 1.568-.809Zm1.75 6.798h1a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25h-1a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25Z"></path>
        </svg>
    </button>
</p>

<div class="expand-feedback-content" id="expandContentLike">
    <ul style="text-align:center">
        <li>Thank you! We received your feedback.</li>
        <li>If you have any comments, fill in <a href='https://www.espressif.com/en/company/documents/documentation_feedback?docId=4287&sections=Build System (migration-guides/release-6.x/6.0/build-system)&version=esp32 latest (master)'>Espressif Documentation Feedback Form</a>.</li>
    </ul>
</div>

<div class="expand-feedback-content" id="expandContent">
    <ul style="text-align:center">
        <li>We value your feedback.</li>
        <li>Let us know how we can improve this page by filling in <a href='https://www.espressif.com/en/company/documents/documentation_feedback?docId=4287&sections=Build System (migration-guides/release-6.x/6.0/build-system)&version=esp32 latest (master)'>Espressif Documentation Feedback Form</a>.</li>
    </ul>
</div>

<br>


             </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Migration from 5.5 to 6.0" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="peripherals.html" class="btn btn-neutral float-right" title="Peripherals" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016 - 2025, Espressif Systems (Shanghai) Co., Ltd.</p>
  </div>

  <ul class="footer">
        <li>
	    
            
            Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/espressif/sphinx_idf_theme">theme</a>  based on <a href="https://github.com/readthedocs/sphinx_rtd_theme">Read the Docs Sphinx Theme</a>.
         </li>
    <li class="footer-aside">
        <a href="../../../esp-idf-en-latest.zip"> Download HTML</a>
    </li>

  </ul> 

</footer>
        </div>
      </div>
    </section>
  </div>

  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>